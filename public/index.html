<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Warsan 305 Bill Splitter - Real-Time</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        :root {
            --primary-color: #5d9cec;
            --secondary-color: #2ecc71;
            --danger-color: #ff6b6b;
            --warning-color: #ffa726;
            --dark-color: #34495e;
            --light-color: #f8f9fa;
            --background-color: #2c3e50;
            --card-color: #34495e;
            --text-color: #ecf0f1;
            --border-color: #4a6572;
        }

        body {
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
            padding: 15px;
            max-width: 1400px;
            margin: 0 auto;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        header {
            text-align: center;
            margin-bottom: 20px;
            padding: 20px 15px;
            background: linear-gradient(135deg, var(--primary-color) 0%, #2980b9 100%);
            color: white;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        h1 {
            margin-bottom: 8px;
            font-size: 1.8rem;
            font-weight: 700;
            letter-spacing: 0.5px;
        }

        .subtitle {
            font-size: 1rem;
            opacity: 0.9;
            font-weight: 300;
            line-height: 1.4;
        }

        .container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .card {
            background: var(--card-color);
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.15);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border: 1px solid var(--border-color);
        }

        .card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
        }

        .card h2 {
            color: var(--text-color);
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--primary-color);
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.3rem;
        }

        .card h2 i {
            color: var(--primary-color);
            font-size: 1.1rem;
        }

        .input-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: var(--text-color);
            font-size: 0.95rem;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s;
            -webkit-appearance: none;
            appearance: none;
            background-color: rgba(255, 255, 255, 0.1);
            color: var(--text-color);
        }

        select {
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23ecf0f1' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 16px;
            padding-right: 40px;
            background-color: rgba(255, 255, 255, 0.1);
        }

        textarea {
            resize: vertical;
            min-height: 80px;
            font-family: inherit;
        }

        input:focus, select:focus, textarea:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(93, 156, 236, 0.25);
            background-color: rgba(255, 255, 255, 0.15);
        }

        input::placeholder, textarea::placeholder {
            color: rgba(236, 240, 241, 0.6);
        }

        .btn {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 14px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s;
            width: 100%;
            margin-top: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            touch-action: manipulation;
        }

        .btn:hover, .btn:active {
            background: #4a89dc;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .btn-calculate {
            background: var(--secondary-color);
        }

        .btn-calculate:hover, .btn-calculate:active {
            background: #27ae60;
        }

        .btn-reset {
            background: var(--danger-color);
        }

        .btn-reset:hover, .btn-reset:active {
            background: #e74c3c;
        }

        .btn-personal-debt {
            background: #9b59b6;
        }

        .btn-personal-debt:hover, .btn-personal-debt:active {
            background: #8e44ad;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .button-group .btn {
            margin-top: 0;
        }

        .results-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 25px;
        }

        .result-card {
            background: var(--card-color);
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.15);
            border: 1px solid var(--border-color);
        }

        .result-card h2 {
            color: var(--text-color);
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--primary-color);
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.3rem;
        }

        .person-list {
            list-style-type: none;
        }

        .person-list li {
            padding: 12px;
            margin-bottom: 8px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(255, 255, 255, 0.05);
            transition: background 0.3s;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .person-list li:active {
            background: rgba(255, 255, 255, 0.1);
        }

        .positive {
            color: #2ecc71;
            font-weight: bold;
        }

        .negative {
            color: #ff6b6b;
            font-weight: bold;
        }

        .settlement-list {
            list-style-type: none;
        }

        .settlement-list li {
            padding: 15px;
            margin-bottom: 12px;
            border-radius: 8px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-left: 4px solid var(--primary-color);
            font-size: 1rem;
            color: white;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.2);
        }

        .settlement-list li i {
            margin-right: 10px;
            color: #ffffff;
            font-size: 1rem;
        }

        .settlement-list li strong {
            color: #ffffff;
            font-weight: 700;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }

        .settlement-summary {
            margin-top: 20px;
            padding: 18px;
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            border-radius: 10px;
            border-left: 4px solid #3498db;
            font-size: 0.95rem;
            color: white;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        }

        .settlement-summary p {
            margin-bottom: 10px;
            line-height: 1.5;
        }

        .settlement-summary p:last-child {
            margin-bottom: 0;
        }

        .settlement-summary strong {
            color: #ffffff;
            font-weight: 700;
        }

        .total-summary {
            display: flex;
            flex-direction: column;
            gap: 15px;
            background: var(--dark-color);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            font-size: 1rem;
            border: 1px solid var(--border-color);
        }

        .total-summary div {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .expense-list, .debt-list {
            margin-top: 15px;
            max-height: 300px;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        .expense-item, .debt-item {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            padding: 12px;
            border-bottom: 1px solid var(--border-color);
            position: relative;
        }

        .expense-item:nth-child(even), .debt-item:nth-child(even) {
            background: rgba(255, 255, 255, 0.05);
        }

        .expense-details, .debt-details {
            flex-grow: 1;
            min-width: 0;
            padding-right: 70px;
        }

        .expense-amount-container, .debt-amount-container {
            display: flex;
            align-items: center;
            gap: 10px;
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
        }

        .expense-amount, .debt-amount {
            font-weight: bold;
            white-space: nowrap;
            min-width: 70px;
            text-align: right;
            font-size: 1rem;
        }

        .expense-meta, .debt-meta {
            display: flex;
            flex-direction: column;
            gap: 3px;
            margin-top: 5px;
            font-size: 0.85rem;
            color: #bdc3c7;
        }

        .no-expenses, .no-debts {
            text-align: center;
            color: #95a5a6;
            font-style: italic;
            padding: 20px;
            font-size: 1rem;
        }

        .person-color {
            display: inline-block;
            width: 14px;
            height: 14px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .person-1 { background-color: #3498db; }
        .person-2 { background-color: #e74c3c; }
        .person-3 { background-color: #2ecc71; }
        .person-4 { background-color: #f39c12; }
        .person-5 { background-color: #9b59b6; }
        .person-6 { background-color: #1abc9c; }
        .person-7 { background-color: #e67e22; }

        .reset-confirmation {
            background: var(--card-color);
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            text-align: center;
            max-width: 500px;
            margin: 0 auto;
            display: none;
            border: 1px solid var(--border-color);
            color: var(--text-color);
        }

        .reset-confirmation.active {
            display: block;
        }

        .confirmation-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            justify-content: center;
        }

        .confirmation-buttons button {
            width: 120px;
            padding: 12px;
        }

        .btn-confirm {
            background: var(--secondary-color);
        }

        .btn-confirm:hover, .btn-confirm:active {
            background: #27ae60;
        }

        .btn-cancel {
            background: #7f8c8d;
        }

        .btn-cancel:hover, .btn-cancel:active {
            background: #6c7b7d;
        }

        .date-input-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .date-input-group input {
            flex-grow: 1;
        }

        .today-btn {
            background: #95a5a6;
            color: white;
            border: none;
            padding: 12px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            white-space: nowrap;
            transition: background 0.3s;
            touch-action: manipulation;
        }

        .today-btn:hover, .today-btn:active {
            background: #7f8c8d;
        }

        .circular-debt-section {
            margin-top: 25px;
            background: var(--card-color);
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.15);
            display: none;
            border: 1px solid var(--border-color);
        }

        .circular-debt-section h2 {
            color: var(--text-color);
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #9b59b6;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.3rem;
        }

        .circular-debt-section h2 i {
            color: #9b59b6;
        }

        .debt-matrix {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            overflow-x: auto;
            display: block;
            -webkit-overflow-scrolling: touch;
        }

        .debt-matrix th {
            background-color: rgba(255, 255, 255, 0.1);
            padding: 10px;
            text-align: center;
            font-weight: 600;
            border: 1px solid var(--border-color);
            font-size: 0.9rem;
            min-width: 80px;
            color: var(--text-color);
        }

        .debt-matrix td {
            padding: 8px;
            text-align: center;
            border: 1px solid var(--border-color);
            font-size: 0.85rem;
            min-width: 80px;
            color: var(--text-color);
        }

        .debt-cell {
            font-weight: 600;
        }

        .debt-cell.positive {
            background-color: rgba(46, 204, 113, 0.2);
            color: #2ecc71;
        }

        .debt-cell.negative {
            background-color: rgba(231, 76, 60, 0.2);
            color: #ff6b6b;
        }

        .diagonal-cell {
            background-color: rgba(255, 255, 255, 0.05);
            color: #95a5a6;
            font-style: italic;
        }

        .tabs {
            display: flex;
            border-bottom: 2px solid var(--primary-color);
            margin-bottom: 20px;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        .tab {
            padding: 12px 15px;
            cursor: pointer;
            font-weight: 600;
            border: none;
            background: none;
            color: var(--text-color);
            transition: all 0.3s;
            white-space: nowrap;
            flex-shrink: 0;
            font-size: 0.95rem;
        }

        .tab.active {
            background: var(--primary-color);
            color: white;
            border-radius: 6px 6px 0 0;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .personal-debt-summary {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 20px;
            display: none;
        }

        .personal-debt-card {
            background: var(--card-color);
            border-radius: 8px;
            padding: 15px;
            flex: 1;
            min-width: 200px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
            border-left: 4px solid #9b59b6;
            border: 1px solid var(--border-color);
        }

        .personal-debt-card h4 {
            margin-bottom: 10px;
            color: var(--text-color);
            font-size: 1.1rem;
        }

        .personal-debt-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--border-color);
            font-size: 0.95rem;
        }

        .personal-debt-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .delete-btn {
            background: var(--danger-color);
            color: white;
            border: none;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            opacity: 0.7;
            transition: opacity 0.3s, transform 0.3s;
            flex-shrink: 0;
            touch-action: manipulation;
        }

        .delete-btn:hover, .delete-btn:active {
            opacity: 1;
            transform: scale(1.1);
        }

        .delete-confirmation {
            background: var(--card-color);
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            text-align: center;
            max-width: 90%;
            margin: 0 auto;
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1000;
            border: 2px solid var(--danger-color);
            width: 90%;
            color: var(--text-color);
        }

        .delete-confirmation.active {
            display: block;
        }

        .delete-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
            display: none;
        }

        .delete-overlay.active {
            display: block;
        }

        .status-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
            margin-left: 8px;
        }

        .status-pending {
            background-color: rgba(255, 243, 205, 0.2);
            color: #ffa726;
        }

        .status-settled {
            background-color: rgba(212, 237, 218, 0.2);
            color: #2ecc71;
        }

        .settle-debt-btn {
            background: var(--secondary-color);
            color: white;
            border: none;
            padding: 6px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.75rem;
            margin-left: 8px;
            transition: background 0.3s;
            touch-action: manipulation;
        }

        .settle-debt-btn:hover, .settle-debt-btn:active {
            background: #27ae60;
        }

        /* Auto-save indicator */
        .auto-save-indicator {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--secondary-color);
            color: white;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 6px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            z-index: 100;
            opacity: 0;
            transform: translateY(10px);
            transition: opacity 0.3s, transform 0.3s;
        }

        .auto-save-indicator.show {
            opacity: 1;
            transform: translateY(0);
        }

        /* Backup/Restore section */
        .backup-section {
            background: var(--card-color);
            border-radius: 10px;
            padding: 20px;
            margin-top: 25px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.15);
            border: 1px solid var(--border-color);
        }

        .backup-section h2 {
            color: var(--text-color);
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--warning-color);
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.3rem;
        }

        .backup-section h2 i {
            color: var(--warning-color);
        }

        .backup-controls {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 15px;
        }

        .backup-info {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 8px;
            font-size: 0.9rem;
            color: #bdc3c7;
            border-left: 4px solid #95a5a6;
        }

        .backup-info p {
            margin-bottom: 8px;
        }

        .backup-info p:last-child {
            margin-bottom: 0;
        }

        .backup-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .btn-backup {
            background: var(--warning-color);
        }

        .btn-backup:hover, .btn-backup:active {
            background: #f39c12;
        }

        .btn-restore {
            background: #3498db;
        }

        .btn-restore:hover, .btn-restore:active {
            background: #2980b9;
        }

        .btn-excel {
            background: #27ae60;
        }

        .btn-excel:hover, .btn-excel:active {
            background: #219653;
        }

        /* Excel Export Options */
        .excel-options {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            border-left: 4px solid #27ae60;
        }

        .excel-options h4 {
            color: var(--text-color);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .export-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 10px;
        }

        .option-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .option-group label {
            margin-bottom: 0;
            font-weight: normal;
            font-size: 0.9rem;
        }

        /* Loading overlay for Excel export */
        .excel-loading {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 10000;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
        }

        .excel-loading.active {
            display: flex;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: var(--secondary-color);
            animation: spin 1s ease-in-out infinite;
            margin-bottom: 20px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Real-time collaboration styles */
        .connection-status {
            position: fixed;
            top: 10px;
            right: 10px;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 8px;
            z-index: 1000;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            transition: all 0.3s;
        }
        
        .status-connected {
            background: #2ecc71;
            color: white;
        }
        
        .status-disconnected {
            background: #e74c3c;
            color: white;
        }
        
        .status-connecting {
            background: #f39c12;
            color: white;
        }
        
        .active-users {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: var(--card-color);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            padding: 15px;
            max-width: 250px;
            z-index: 100;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            display: none;
        }
        
        .active-users h4 {
            margin-bottom: 10px;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .user-list {
            list-style: none;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .user-list li {
            padding: 8px 12px;
            margin-bottom: 5px;
            border-radius: 6px;
            background: rgba(255, 255, 255, 0.05);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            font-size: 0.9rem;
        }
        
        .user-typing {
            font-style: italic;
            color: #95a5a6;
            font-size: 0.8rem;
            margin-left: 5px;
        }
        
        /* Typing indicator */
        .typing-indicator {
            background: var(--card-color);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            padding: 10px 15px;
            margin-top: 10px;
            font-size: 0.85rem;
            color: #95a5a6;
            display: none;
        }
        
        /* Edit indicator */
        .edit-indicator {
            position: absolute;
            top: -20px;
            right: 5px;
            background: var(--primary-color);
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.7rem;
            display: none;
        }
        
        .expense-item, .debt-item {
            position: relative;
        }
        
        /* Real-time activity feed */
        .activity-feed {
            background: var(--card-color);
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            border: 1px solid var(--border-color);
            max-height: 300px;
            overflow-y: auto;
        }
        
        .activity-feed h3 {
            margin-bottom: 15px;
            color: var(--text-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .activity-item {
            padding: 10px;
            margin-bottom: 8px;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.05);
            border-left: 3px solid var(--primary-color);
            font-size: 0.9rem;
        }
        
        .activity-time {
            font-size: 0.8rem;
            color: #95a5a6;
            margin-top: 3px;
        }

        /* Mobile-specific optimizations */
        @media (max-width: 768px) {
            body {
                padding: 12px;
            }

            header {
                padding: 18px 12px;
                margin-bottom: 15px;
            }

            h1 {
                font-size: 1.5rem;
            }

            .subtitle {
                font-size: 0.9rem;
            }

            .container {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .card {
                padding: 18px;
            }

            .card h2, .result-card h2 {
                font-size: 1.2rem;
            }

            .results-section {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .button-group {
                flex-direction: column;
            }

            .confirmation-buttons {
                flex-direction: column;
                align-items: center;
            }

            .confirmation-buttons button {
                width: 100%;
                max-width: 200px;
            }

            .expense-meta, .debt-meta {
                font-size: 0.8rem;
            }

            .date-input-group {
                flex-direction: column;
            }

            .today-btn {
                width: 100%;
                padding: 12px;
            }

            .debt-matrix {
                font-size: 0.8rem;
            }

            .debt-matrix th, .debt-matrix td {
                padding: 6px 4px;
                min-width: 70px;
            }

            .personal-debt-summary {
                flex-direction: column;
            }

            .personal-debt-card {
                min-width: 100%;
            }

            .delete-confirmation {
                width: 90%;
                padding: 18px;
            }

            .total-summary {
                padding: 15px;
                font-size: 0.95rem;
            }

            .expense-amount, .debt-amount {
                font-size: 0.95rem;
                min-width: 60px;
            }

            .expense-amount-container, .debt-amount-container {
                gap: 8px;
            }

            .delete-btn {
                width: 26px;
                height: 26px;
            }

            .tab {
                padding: 10px 12px;
                font-size: 0.9rem;
            }

            .btn {
                padding: 14px;
                font-size: 0.95rem;
            }

            input, select, textarea {
                padding: 12px;
                font-size: 1rem;
            }

            label {
                font-size: 0.9rem;
            }

            .person-list li {
                padding: 10px;
                font-size: 0.95rem;
            }

            .settlement-list li {
                padding: 12px;
                font-size: 0.95rem;
                margin-bottom: 10px;
            }

            .settlement-summary {
                padding: 15px;
                font-size: 0.9rem;
            }

            .backup-buttons {
                flex-direction: column;
            }

            .backup-section {
                padding: 15px;
            }

            .auto-save-indicator {
                bottom: 10px;
                right: 10px;
                font-size: 0.7rem;
                padding: 6px 10px;
            }

            .export-options {
                flex-direction: column;
            }

            .option-group {
                flex-direction: column;
                align-items: flex-start;
                gap: 5px;
            }

            /* Real-time elements mobile adjustments */
            .connection-status {
                top: 5px;
                right: 5px;
                font-size: 0.7rem;
                padding: 6px 10px;
            }
            
            .active-users {
                bottom: 10px;
                left: 10px;
                max-width: 200px;
                padding: 12px;
            }
            
            .user-avatar {
                width: 28px;
                height: 28px;
                font-size: 0.8rem;
            }
        }

        @media (max-width: 480px) {
            .expense-details, .debt-details {
                padding-right: 60px;
            }

            .expense-amount, .debt-amount {
                min-width: 55px;
                font-size: 0.9rem;
            }

            .card h2, .result-card h2 {
                font-size: 1.1rem;
            }

            h1 {
                font-size: 1.3rem;
            }

            .subtitle {
                font-size: 0.85rem;
            }

            .debt-matrix th, .debt-matrix td {
                min-width: 60px;
                padding: 5px 3px;
                font-size: 0.75rem;
            }

            .person-color {
                width: 12px;
                height: 12px;
            }

            .total-summary div {
                flex-direction: column;
                gap: 5px;
                text-align: center;
            }

            .settlement-list li {
                padding: 10px;
                font-size: 0.9rem;
            }

            .settlement-summary {
                padding: 12px;
                font-size: 0.85rem;
            }

            /* Real-time elements extra small adjustments */
            .active-users {
                max-width: 180px;
            }
        }

        @media (max-width: 350px) {
            .expense-details, .debt-details {
                padding-right: 50px;
            }

            .expense-amount, .debt-amount {
                min-width: 45px;
                font-size: 0.85rem;
            }

            .card h2, .result-card h2 {
                font-size: 1rem;
            }

            .card {
                padding: 15px;
            }
        }

        /* Improve touch targets on very small screens */
        @media (max-height: 600px) {
            .btn {
                padding: 12px;
            }

            .card {
                padding: 15px;
            }

            header {
                padding: 15px 12px;
            }
        }

        /* Light mode support - optional if user prefers light */
        @media (prefers-color-scheme: light) {
            body {
                background-color: #f5f9ff;
                color: #333;
            }

            .card, .result-card, .circular-debt-section, .reset-confirmation, .delete-confirmation, .personal-debt-card, .backup-section, .excel-options {
                background-color: white;
                color: #333;
                box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
                border: 1px solid #e1e8ed;
            }

            .card h2, .result-card h2 {
                color: #2c3e50;
            }

            label {
                color: #2c3e50;
            }

            input, select, textarea {
                background-color: white;
                color: #333;
                border-color: #ddd;
            }

            input:focus, select:focus, textarea:focus {
                border-color: var(--primary-color);
                box-shadow: 0 0 0 3px rgba(93, 156, 236, 0.15);
            }

            .person-list li, .expense-item:nth-child(even), .debt-item:nth-child(even) {
                background-color: #f8f9fa;
            }

            .expense-item, .debt-item {
                border-bottom-color: #eee;
            }

            .debt-matrix th {
                background-color: #f8f9fa;
                border-color: #ddd;
                color: #333;
            }

            .debt-matrix td {
                border-color: #ddd;
                color: #333;
            }

            .diagonal-cell {
                background-color: #f8f9fa;
                color: #7f8c8d;
            }

            .expense-meta, .debt-meta {
                color: #666;
            }

            .backup-info, .excel-options {
                background-color: #f8f9fa;
                color: #666;
                border-left: 4px solid #95a5a6;
            }

            /* Real-time elements light mode */
            .active-users, .typing-indicator, .activity-feed, .activity-item {
                background-color: white;
                color: #333;
                border-color: #e1e8ed;
            }
            
            .user-list li {
                background-color: #f8f9fa;
            }
        }

        /* Print styles */
        @media print {
            .btn, .delete-btn, .settle-debt-btn, .today-btn, .tabs, .backup-section, .auto-save-indicator, .excel-loading {
                display: none !important;
            }

            .card {
                box-shadow: none;
                border: 1px solid #ddd;
            }

            body {
                background: white;
                color: black;
                padding: 0;
            }

            .settlement-list li {
                background: #f8f9fa !important;
                color: #333 !important;
                border: 1px solid #ddd !important;
            }

            .settlement-summary {
                background: #e8f4fc !important;
                color: #333 !important;
                border: 1px solid #ddd !important;
            }

            /* Hide real-time elements when printing */
            .connection-status, .active-users, .activity-feed {
                display: none !important;
            }
        }
    </style>
</head>
<body>
    <!-- Connection Status Indicator -->
    <div id="connection-status" class="connection-status status-connecting">
        <i class="fas fa-circle"></i>
        <span>Connecting...</span>
    </div>
    
    <!-- Active Users Panel -->
    <div id="active-users" class="active-users">
        <h4><i class="fas fa-users"></i> Online Now</h4>
        <ul id="user-list" class="user-list">
            <!-- Users will be added dynamically -->
        </ul>
        <div id="typing-indicator" class="typing-indicator">
            <!-- Typing indicators will appear here -->
        </div>
    </div>
    
    <header>
        <h1><i class="fas fa-home"></i> Warsan 305 - Real-Time</h1>
        <p class="subtitle">Live Collaborative Bill Splitter for 7 Roommates</p>
    </header>

    <div class="container">
        <div class="card">
            <div class="tabs">
                <button class="tab active" data-tab="shared-expense">Shared Expense</button>
                <button class="tab" data-tab="personal-debt">Personal Debt</button>
            </div>

            <div id="shared-expense-tab" class="tab-content active">
                <h2><i class="fas fa-plus-circle"></i> Add Shared Expense</h2>
                <div class="input-group">
                    <label for="expense-type">Expense Type</label>
                    <select id="expense-type">
                        <option value="utility">Utility Bill</option>
                        <option value="grocery">Grocery</option>
                        <option value="other">Other</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="expense-name">Expense Name</label>
                    <input type="text" id="expense-name" placeholder="e.g., Electricity Bill, Weekly Groceries">
                </div>

                <div class="input-group">
                    <label for="expense-amount">Amount ($)</label>
                    <input type="number" id="expense-amount" min="0" step="0.01" placeholder="0.00" inputmode="decimal">
                </div>

                <div class="input-group">
                    <label for="invoice-date">Invoice Date</label>
                    <div class="date-input-group">
                        <input type="date" id="invoice-date">
                        <button type="button" id="today-btn" class="today-btn">Today</button>
                    </div>
                </div>

                <div class="input-group">
                    <label for="paid-by">Paid By</label>
                    <select id="paid-by">
                        <option value="person1">Brian</option>
                        <option value="person2">Tessa</option>
                        <option value="person3">Robert</option>
                        <option value="person4">Hershey</option>
                        <option value="person5">Wilson</option>
                        <option value="person6">Joselle</option>
                        <option value="person7">Chona</option>
                    </select>
                </div>

                <button id="add-expense-btn" class="btn"><i class="fas fa-plus"></i> Add Shared Expense</button>
            </div>

            <div id="personal-debt-tab" class="tab-content">
                <h2><i class="fas fa-hand-holding-usd"></i> Add Personal Debt</h2>
                <div class="input-group">
                    <label for="debt-from">Who Owes Money?</label>
                    <select id="debt-from">
                        <option value="person1">Brian</option>
                        <option value="person2">Tessa</option>
                        <option value="person3">Robert</option>
                        <option value="person4">Hershey</option>
                        <option value="person5">Wilson</option>
                        <option value="person6">Joselle</option>
                        <option value="person7">Chona</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="debt-to">Who Is Owed Money?</label>
                    <select id="debt-to">
                        <option value="person1">Brian</option>
                        <option value="person2">Tessa</option>
                        <option value="person3">Robert</option>
                        <option value="person4">Hershey</option>
                        <option value="person5">Wilson</option>
                        <option value="person6">Joselle</option>
                        <option value="person7">Chona</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="debt-amount">Amount ($)</label>
                    <input type="number" id="debt-amount" min="0" step="0.01" placeholder="0.00" inputmode="decimal">
                </div>

                <div class="input-group">
                    <label for="debt-description">Description</label>
                    <input type="text" id="debt-description" placeholder="e.g., Loan, Borrowed money for dinner">
                </div>

                <div class="input-group">
                    <label for="debt-date">Date</label>
                    <div class="date-input-group">
                        <input type="date" id="debt-date">
                        <button type="button" id="debt-today-btn" class="today-btn">Today</button>
                    </div>
                </div>

                <div class="input-group">
                    <label for="debt-notes">Notes (Optional)</label>
                    <textarea id="debt-notes" placeholder="Additional details about this debt..."></textarea>
                </div>

                <button id="add-debt-btn" class="btn btn-personal-debt"><i class="fas fa-plus"></i> Add Personal Debt</button>
            </div>
        </div>

        <div class="card">
            <h2><i class="fas fa-users"></i> Roommates</h2>
            <ul class="person-list">
                <li><span><span class="person-color person-1"></span>Brian</span> <span id="balance1">$0.00</span></li>
                <li><span><span class="person-color person-2"></span>Tessa</span> <span id="balance2">$0.00</span></li>
                <li><span><span class="person-color person-3"></span>Robert</span> <span id="balance3">$0.00</span></li>
                <li><span><span class="person-color person-4"></span>Hershey</span> <span id="balance4">$0.00</span></li>
                <li><span><span class="person-color person-5"></span>Wilson</span> <span id="balance5">$0.00</span></li>
                <li><span><span class="person-color person-6"></span>Joselle</span> <span id="balance6">$0.00</span></li>
                <li><span><span class="person-color person-7"></span>Chona</span> <span id="balance7">$0.00</span></li>
            </ul>

            <div class="button-group">
                <button id="calculate-btn" class="btn btn-calculate"><i class="fas fa-calculator"></i> Calculate</button>
                <button id="reset-btn" class="btn btn-reset"><i class="fas fa-redo"></i> Reset All</button>
            </div>
        </div>
    </div>

    <div class="results-section">
        <div class="result-card">
            <h2><i class="fas fa-receipt"></i> Recent Shared Expenses</h2>
            <div class="expense-list" id="expense-list">
                <div class="no-expenses">No shared expenses added yet</div>
            </div>
        </div>

        <div class="result-card">
            <h2><i class="fas fa-file-invoice-dollar"></i> Recent Personal Debts</h2>
            <div class="debt-list" id="debt-list">
                <div class="no-debts">No personal debts added yet</div>
            </div>
        </div>

        <div class="result-card">
            <h2><i class="fas fa-exchange-alt"></i> Combined Settlement Plan</h2>
            <div id="settlement-container">
                <p class="no-expenses">Click "Calculate" to see who owes whom (including personal debts)</p>
            </div>
        </div>
    </div>

    <div class="circular-debt-section" id="circular-debt-section">
        <h2><i class="fas fa-sync-alt"></i> Combined Debt Matrix</h2>
        <p>This matrix shows total debts including both shared expenses and personal debts. Each cell shows how much the row person owes the column person.</p>
        <div id="debt-matrix-container"></div>
    </div>

    <div class="personal-debt-summary" id="personal-debt-summary">
        <!-- Personal debt cards will be dynamically added here -->
    </div>

    <!-- Real-time Activity Feed -->
    <div class="activity-feed" id="activity-feed">
        <h3><i class="fas fa-bell"></i> Recent Activity</h3>
        <div id="activity-list">
            <div class="activity-item">
                <i class="fas fa-info-circle"></i> Welcome! This is a real-time collaborative space.
            </div>
        </div>
    </div>

    <div class="backup-section">
        <h2><i class="fas fa-database"></i> Data Management & Export</h2>
        <div class="backup-info">
            <p><strong>Real-time collaboration is enabled:</strong> All 7 roommates can see changes instantly.</p>
            <p><strong>Data is stored on the server:</strong> All data is synchronized in real-time.</p>
            <p><strong>Multiple export options:</strong> Export to JSON backup or Excel spreadsheet for easy sharing and analysis.</p>
        </div>

        <div class="excel-options">
            <h4><i class="fas fa-file-excel"></i> Excel Export Options</h4>
            <div class="export-options">
                <div class="option-group">
                    <input type="checkbox" id="export-expenses" checked>
                    <label for="export-expenses">Include Shared Expenses</label>
                </div>
                <div class="option-group">
                    <input type="checkbox" id="export-debts" checked>
                    <label for="export-debts">Include Personal Debts</label>
                </div>
                <div class="option-group">
                    <input type="checkbox" id="export-settlements" checked>
                    <label for="export-settlements">Include Settlement Plan</label>
                </div>
                <div class="option-group">
                    <input type="checkbox" id="export-summary" checked>
                    <label for="export-summary">Include Summary & Balances</label>
                </div>
            </div>
        </div>

        <div class="backup-controls">
            <div class="backup-buttons">
                <button id="export-excel-btn" class="btn btn-excel"><i class="fas fa-file-excel"></i> Export to Excel</button>
                <button id="export-btn" class="btn btn-backup"><i class="fas fa-file-export"></i> Export JSON Backup</button>
                <button id="import-btn" class="btn btn-restore"><i class="fas fa-file-import"></i> Import JSON Backup</button>
                <button id="clear-data-btn" class="btn btn-reset"><i class="fas fa-trash-alt"></i> Clear Local Data</button>
            </div>
        </div>
    </div>

    <div class="total-summary">
        <div>
            <strong>Total Shared Expenses:</strong> <span id="total-expenses">$0.00</span>
        </div>
        <div>
            <strong>Total Personal Debts:</strong> <span id="total-personal-debts">$0.00</span>
        </div>
        <div>
            <strong>Share per Person:</strong> <span id="share-per-person">$0.00</span>
        </div>
    </div>

    <!-- Excel Export Loading Overlay -->
    <div class="excel-loading" id="excel-loading">
        <div class="loading-spinner"></div>
        <h3>Preparing Excel File...</h3>
        <p>This may take a moment depending on the amount of data.</p>
    </div>

    <!-- Auto-save indicator -->
    <div class="auto-save-indicator" id="auto-save-indicator">
        <i class="fas fa-save"></i> Saved
    </div>

    <!-- Delete Confirmation Dialog -->
    <div class="delete-confirmation" id="delete-confirmation">
        <h3><i class="fas fa-exclamation-triangle"></i> Confirm Deletion</h3>
        <p id="delete-message">Are you sure you want to delete this item?</p>
        <div class="confirmation-buttons">
            <button id="confirm-delete-btn" class="btn btn-confirm"><i class="fas fa-check"></i> Yes, Delete</button>
            <button id="cancel-delete-btn" class="btn btn-cancel"><i class="fas fa-times"></i> Cancel</button>
        </div>
    </div>

    <!-- Overlay for delete confirmation -->
    <div class="delete-overlay" id="delete-overlay"></div>

    <!-- Reset Confirmation Dialog -->
    <div class="reset-confirmation" id="reset-confirmation">
        <h3><i class="fas fa-exclamation-triangle"></i> Reset All Data</h3>
        <p>Are you sure you want to reset all data? This will:</p>
        <ul style="text-align: left; margin: 15px 0; padding-left: 20px;">
            <li>Clear all shared expense records</li>
            <li>Clear all personal debt records</li>
            <li>Reset all person balances to $0</li>
            <li>Clear all settlement calculations</li>
        </ul>
        <p>This action cannot be undone.</p>
        <div class="confirmation-buttons">
            <button id="confirm-reset-btn" class="btn btn-confirm"><i class="fas fa-check"></i> Yes, Reset</button>
            <button id="cancel-reset-btn" class="btn btn-cancel"><i class="fas fa-times"></i> Cancel</button>
        </div>
    </div>

    <!-- Socket.io will be served by the server -->
    <script src="/socket.io/socket.io.js"></script>
    <script src="/app.js"></script>
    <script src="/realtime.js"></script>
</body>
</html>